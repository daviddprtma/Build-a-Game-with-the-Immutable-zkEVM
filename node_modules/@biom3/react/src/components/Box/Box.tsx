import { ReactElement, ReactNode } from 'react';

import { useConvertSxToEmotionStyles } from '../../hooks/useConvertSxToEmotionStyles';
import {
  DomPropsWithDomRef,
  StandardComponentWithProps,
} from '../../types/shared';
import { cloneElementWithCssProp } from '../../utils';

export type BoxProps = StandardComponentWithProps<
  HTMLDivElement,
  {
    children?: ReactNode;
  }
>;

export type BoxWithRCAndDomProps<
  RC extends ReactElement | undefined = undefined,
> = RC extends undefined
  ? DomPropsWithDomRef<'div'> & BoxProps
  : BoxProps & { rc: RC };

export function Box<RC extends ReactElement | undefined = undefined>({
  testId,
  sx = {},
  children,
  rc = <div />,
  domRef,
  className,
  ...domProps
}: BoxWithRCAndDomProps<RC>) {
  const css = useConvertSxToEmotionStyles(sx);
  return cloneElementWithCssProp(rc, {
    ...domProps,
    ...(testId ? { 'data-testid': testId } : {}),
    ...(domRef ? { ref: domRef } : {}),
    className: `${className ?? ''} Box`,
    css,
    children,
  });
}

Box.displayName = 'Box';
