import { ReactElement } from 'react';
import merge from 'ts-deepmerge';

import { useTheme } from '../../hooks';
import { MakeResponsive } from '../../types/shared';
import { getStartingSize } from '../../utils/styleHelpers';
import { lineClamp } from '../../utils/sxChunks';
import { Box, BoxWithRCAndDomProps } from '../Box';
import {
  DEFAULT_MENU_ITEM_SIZE,
  MENU_ITEM_SIZES,
  MenuItemSize,
} from './shared';
import { renderCaptionSx, renderResponsiveCaptionSx } from './styles';

export type MenuItemCaptionProps<
  RC extends ReactElement | undefined = undefined,
> = BoxWithRCAndDomProps<RC> & { size?: MakeResponsive<MenuItemSize> };

export function MenuItemCaption<
  RC extends ReactElement | undefined = undefined,
>({
  size = DEFAULT_MENU_ITEM_SIZE,
  sx = {},
  rc = <span />,
  ...props
}: MenuItemCaptionProps<RC>) {
  const themeProps = useTheme();
  const startingSize = getStartingSize(
    size,
    DEFAULT_MENU_ITEM_SIZE,
    MENU_ITEM_SIZES,
  );
  const allSx = merge(
    {
      ...lineClamp(2),
      color: 'base.color.text.secondary',
      textAlign: 'left',
    },
    renderCaptionSx({ theme: themeProps, size: startingSize }),
    renderResponsiveCaptionSx({
      theme: themeProps,
      size,
    }),
    sx,
  );
  return <Box {...props} sx={allSx} rc={rc} />;
}

MenuItemCaption.displayName = 'MenuItem.Caption';
