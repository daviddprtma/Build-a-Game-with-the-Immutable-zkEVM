import { Children, cloneElement, ReactElement, useContext } from 'react';

import { isChildSubcomponent, renderNullAndWarnUser } from '../../utils';
import { Box, BoxWithRCAndDomProps } from '../Box';
import { TableContext } from './context';
import { TableRow } from './TableRow';

export type TableBodyProps<RC extends ReactElement | undefined = undefined> =
  BoxWithRCAndDomProps<RC>;

export function TableBody<RC extends ReactElement | undefined = undefined>({
  children,
  rc = <tbody />,
  className,
  testId: testIdProp,
  ...props
}: TableBodyProps<RC>) {
  const { testId } = useContext(TableContext);
  return (
    <Box
      {...props}
      rc={rc}
      testId={`${testIdProp ?? testId}__tbody`}
      className={`${className ?? ''} tbody`}
    >
      {Children.map(children, child => {
        if (isChildSubcomponent(child, TableRow)) {
          return cloneElement(child, { parentNode: 'tbody' });
        }

        return renderNullAndWarnUser(TableBody.displayName);
      })}
    </Box>
  );
}

TableBody.displayName = 'Table.Body';
