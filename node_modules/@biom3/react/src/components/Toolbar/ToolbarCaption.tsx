import { useTheme } from '@emotion/react';
import merge from 'ts-deepmerge';

import { MakeResponsive } from '../../types/shared';
import { getStartingSize } from '../../utils/styleHelpers';
import { lineClamp } from '../../utils/sxChunks';
import { Box, BoxProps } from '../Box';
import { DEFAULT_TOOLBAR_SIZE, TOOLBAR_SIZES, ToolbarSize } from './shared';
import { getCaptionStyles, getResponsiveCaptionStyles } from './styles';

export type ToolbarCaptionProps = Omit<BoxProps, 'rc'> & {
  size?: MakeResponsive<ToolbarSize>;
};

export function ToolbarCaption({
  size = DEFAULT_TOOLBAR_SIZE,
  sx = {},
  ...props
}: ToolbarCaptionProps) {
  const themeProps = useTheme();
  const startingSize = getStartingSize(
    size,
    DEFAULT_TOOLBAR_SIZE,
    TOOLBAR_SIZES,
  );
  const captionStyles = merge(
    { ...lineClamp(1), color: 'base.color.text.secondary' },
    getCaptionStyles({ themeProps, size: startingSize }),
    getResponsiveCaptionStyles({
      themeProps,
      size,
    }),
    sx,
  );
  return <Box {...props} sx={captionStyles} rc={<p />} />;
}

ToolbarCaption.displayName = 'Toolbar.Caption';
