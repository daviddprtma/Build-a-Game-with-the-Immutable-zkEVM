import { base } from '@biom3/design-tokens';

import {
  cyGetByTestId,
  cyMountWithProviders,
  cySmartGet,
} from '../../utils/testHelpers';
import { Box } from '../Box';
import { Stack } from './Stack';

describe('<Stack />', () => {
  it('should have correct displayName', () => {
    expect(Stack.displayName).to.eq('Stack');
  });

  it('should correctly forward domRef', () => {
    const domRef = cy.stub().as('domRef');
    cyMountWithProviders(
      <Stack testId="moo" domRef={domRef}>
        dsads
      </Stack>,
    );

    cySmartGet('@domRef').should('be.calledOnce');
  });

  it('should apply some gap spacing by default', () => {
    cyMountWithProviders(
      <Stack testId="moo">
        <div>moo</div>
      </Stack>,
    );
    cySmartGet('moo').should('have.css', 'gap', '8px');
  });

  it('should not apply default gap, when either rowGap or columnGap is provided', () => {
    cyMountWithProviders(
      <Stack testId="moo" rowGap="base.spacing.x3">
        <div>moo</div>
      </Stack>,
    );
    cySmartGet('moo').should('have.css', 'gap', '12px normal');

    cyMountWithProviders(
      <Stack testId="moo" columnGap="base.spacing.x4">
        <div>moo</div>
      </Stack>,
    );
    cySmartGet('moo').should('have.css', 'gap', 'normal 16px');
  });

  it('should allow consumer to use a custom css color', () => {
    cyMountWithProviders(
      <Stack
        testId="moo"
        sx={{
          bgc: 'dodgerblue',
        }}
      >
        dsads
      </Stack>,
    );

    cyGetByTestId('moo').should('have.backgroundColor', 'dodgerblue');
  });

  it('should correctly apply responsive flex properties, when neccissary', () => {
    cy.viewport(base.breakpoint.small - 100, 200);
    cyMountWithProviders(
      <Stack
        testId="moo"
        alignItems={['center', 'flex-start', 'flex-end']}
        sx={{
          w: '100vw',
          h: '100vh',
        }}
      >
        <Box sx={{ w: '20px', h: '20px', bgc: 'gold' }} />
        <Box sx={{ w: '20px', h: '20px', bgc: 'gold' }} />
        <Box sx={{ w: '20px', h: '20px', bgc: 'gold' }} />
        <Box sx={{ w: '20px', h: '20px', bgc: 'gold' }} />
      </Stack>,
    );

    cyGetByTestId('moo').should('have.css', 'align-items', 'center');

    cy.viewport(base.breakpoint.small + 1, 200);
    cyGetByTestId('moo').should('have.css', 'align-items', 'flex-start');

    cy.viewport(base.breakpoint.medium + 1, 200);
    cyGetByTestId('moo').should('have.css', 'align-items', 'flex-end');
  });
});
